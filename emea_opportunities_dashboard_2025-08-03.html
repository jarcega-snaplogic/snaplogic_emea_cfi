```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EMEA Closed Won Opportunities Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-bg: #f8f9fa;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        body {
            background-color: var(--light-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .dashboard-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            border-left: 4px solid var(--secondary-color);
            transition: transform 0.2s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .metric-label {
            color: #6c757d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .data-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .table th {
            background-color: var(--primary-color);
            color: white;
            border: none;
            font-weight: 600;
        }

        .table td {
            vertical-align: middle;
            border-color: #dee2e6;
        }

        .filter-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
        }

        .insight-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            border-left: 4px solid var(--success-color);
            margin-bottom: 1rem;
        }

        .recommendation-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            border-left: 4px solid var(--warning-color);
            margin-bottom: 1rem;
        }

        .region-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .region-north { background-color: #e3f2fd; color: #1976d2; }
        .region-south { background-color: #f3e5f5; color: #7b1fa2; }
        .region-dach { background-color: #e8f5e8; color: #388e3c; }

        .opportunity-type-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .type-renewal { background-color: #fff3e0; color: #f57c00; }
        .type-addon { background-color: #e8f5e8; color: #388e3c; }
        .type-new { background-color: #e3f2fd; color: #1976d2; }

        .export-btn {
            background: var(--success-color);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            transition: background 0.2s ease;
        }

        .export-btn:hover {
            background: #219a52;
        }

        @media (max-width: 768px) {
            .metric-value {
                font-size: 2rem;
            }
            
            .dashboard-header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-2"><i class="fas fa-chart-line me-3"></i>EMEA Closed Won Opportunities Dashboard</h1>
                    <p class="mb-0 opacity-75">Comprehensive analysis of closed won opportunities across EMEA regions</p>
                </div>
                <div class="col-md-4 text-end">
                    <div id="lastUpdated" class="small opacity-75"></div>
                    <button id="refreshBtn" class="btn btn-outline-light btn-sm mt-2">
                        <i class="fas fa-sync-alt me-1"></i>Refresh Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <!-- Loading State -->
        <div id="loadingState" class="loading-spinner">
            <div class="text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3 text-muted">Loading opportunity data...</p>
            </div>
        </div>

        <!-- Error State -->
        <div id="errorState" class="alert alert-danger d-none" role="alert">
            <h4 class="alert-heading"><i class="fas fa-exclamation-triangle me-2"></i>Data Loading Error</h4>
            <p>Unable to load opportunities data. Please check if opportunities.json is available and try again.</p>
            <button class="btn btn-danger" onclick="loadData()">Retry</button>
        </div>

        <!-- Main Dashboard Content -->
        <div id="dashboardContent" class="d-none">
            <!-- Executive Summary -->
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="mb-3"><i class="fas fa-tachometer-alt me-2"></i>Executive Summary</h2>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="metric-card">
                        <div class="metric-value" id="totalRevenue">$0</div>
                        <div class="metric-label">Total Revenue</div>
                        <div class="small text-muted mt-1" id="revenueGrowth"></div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="metric-card">
                        <div class="metric-value" id="totalDeals">0</div>
                        <div class="metric-label">Total Deals</div>
                        <div class="small text-muted mt-1" id="dealGrowth"></div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="metric-card">
                        <div class="metric-value" id="avgDealSize">$0</div>
                        <div class="metric-label">Average Deal Size</div>
                        <div class="small text-muted mt-1" id="avgDealTrend"></div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="metric-card">
                        <div class="metric-value" id="topRegion">-</div>
                        <div class="metric-label">Top Performing Region</div>
                        <div class="small text-muted mt-1" id="topRegionRevenue"></div>
                    </div>
                </div>
            </div>

            <!-- Filters -->
            <div class="filter-section">
                <div class="row align-items-center">
                    <div class="col-md-3">
                        <label class="form-label">Region Filter</label>
                        <select id="regionFilter" class="form-select">
                            <option value="">All Regions</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Opportunity Type</label>
                        <select id="typeFilter" class="form-select">
                            <option value="">All Types</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Lead Source</label>
                        <select id="sourceFilter" class="form-select">
                            <option value="">All Sources</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Actions</label>
                        <div>
                            <button id="exportBtn" class="export-btn me-2">
                                <i class="fas fa-download me-1"></i>Export CSV
                            </button>
                            <button id="clearFilters" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-1"></i>Clear
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="row mb-4">
                <div class="col-lg-8">
                    <div class="chart-container">
                        <h4><i class="fas fa-chart-bar me-2"></i>Revenue by Month</h4>
                        <canvas id="revenueChart" height="100"></canvas>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="chart-container">
                        <h4><i class="fas fa-chart-pie me-2"></i>Revenue by Region</h4>
                        <canvas id="regionChart" height="200"></canvas>
                    </div>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4><i class="fas fa-chart-area me-2"></i>Deal Size Distribution</h4>
                        <canvas id="dealSizeChart" height="150"></canvas>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chart-container">
                        <h4><i class="fas fa-funnel-dollar me-2"></i>Lead Source Performance</h4>
                        <canvas id="leadSourceChart" height="150"></canvas>
                    </div>
                </div>
            </div>

            <!-- Detailed Analytics -->
            <div class="row mb-4">
                <div class="col-12">
                    <h3><i class="fas fa-analytics me-2"></i>Detailed Analytics</h3>
                </div>
                <div class="col-lg-4">
                    <div class="insight-card">
                        <h5><i class="fas fa-lightbulb me-2"></i>Key Insights</h5>
                        <div id="keyInsights">
                            <div class="loading-spinner">
                                <div class="spinner-border spinner-border-sm" role="status"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="recommendation-card">
                        <h5><i class="fas fa-rocket me-2"></i>Recommendations</h5>
                        <div id="recommendations">
                            <div class="loading-spinner">
                                <div class="spinner-border spinner-border-sm" role="status"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="insight-card">
                        <h5><i class="fas fa-exclamation-triangle me-2"></i>Risk Factors</h5>
                        <div id="riskFactors">
                            <div class="loading-spinner">
                                <div class="spinner-border spinner-border-sm" role="status"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Opportunities Table -->
            <div class="data-table">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Opportunity Name</th>
                                <th>Account</th>
                                <th>Owner</th>
                                <th>Amount</th>
                                <th>Close Date</th>
                                <th>Region</th>
                                <th>Type</th>
                                <th>Lead Source</th>
                            </tr>
                        </thead>
                        <tbody id="opportunitiesTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let allOpportunities = [];
        let filteredOpportunities = [];
        let charts = {};

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('refreshBtn').addEventListener('click', loadData);
            document.getElementById('regionFilter').addEventListener('change', applyFilters);
            document.getElementById('typeFilter').addEventListener('change', applyFilters);
            document.getElementById('sourceFilter').addEventListener('change', applyFilters);
            document.getElementById('clearFilters').addEventListener('click', clearFilters);
            document.getElementById('exportBtn').addEventListener('click', exportToCSV);
        }

        // Load data from opportunities.json
        async function loadData() {
            try {
                showLoading();
                const response = await fetch('opportunities.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                allOpportunities = await response.json();
                filteredOpportunities = [...allOpportunities];
                
                // Process and display data
                processData();
                updateDashboard();
                hideLoading();
                
                document.getElementById('lastUpdated').textContent = 
                    `Last updated: ${new Date().toLocaleString()}`;
                    
            } catch (error) {
                console.error('Error loading data:', error);
                showError();
            }
        }

        // Show loading state
        function showLoading() {
            document.getElementById('loadingState').classList.remove('d-none');
            document.getElementById('dashboardContent').classList.add('d-none');
            document.getElementById('errorState').classList.add('d-none');
        }

        // Hide loading state
        function hideLoading() {
            document.getElementById('loadingState').classList.add('d-none');
            document.getElementById('dashboardContent').classList.remove('d-none');
            document.getElementById('errorState').classList.add('d-none');
        }

        // Show error state
        function showError() {
            document.getElementById('loadingState').classList.add('d-none');
            document.getElementById('dashboardContent').classList.add('d-none');
            document.getElementById('errorState').classList.remove('d-none');
        }

        // Process data and calculate metrics
        function processData() {
            // Calculate basic metrics
            const totalRevenue = filteredOpportunities.reduce((sum, opp) => sum + (opp.amount || 0), 0);
            const totalDeals = filteredOpportunities.length;
            const avgDealSize = totalDeals > 0 ? totalRevenue / totalDeals : 0;

            // Update executive summary
            document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('totalDeals').textContent = totalDeals.toLocaleString();
            document.getElementById('avgDealSize').textContent = formatCurrency(avgDealSize);

            // Calculate top performing region
            const regionRevenue = {};
            filteredOpportunities.forEach(opp => {
                const region = opp.region || 'Unknown';
                regionRevenue[region] = (regionRevenue[region] || 0) + (opp.amount || 0);
            });

            const topRegion = Object.keys(regionRevenue).reduce((a, b) => 
                regionRevenue[a] > regionRevenue[b] ? a : b, 'N/A');
            
            document.getElementById('topRegion').textContent = topRegion;
            document.getElementById('topRegionRevenue').textContent = 
                formatCurrency(regionRevenue[topRegion] || 0);

            // Populate filter options
            populateFilters();
        }

        // Populate filter dropdowns
        function populateFilters() {
            const regions = [...new Set(allOpportunities.map(opp => opp.region).filter(Boolean))];
            const types = [...new Set(allOpportunities.map(opp => opp.opportunity_type).filter(Boolean))];
            const sources = [...new Set(allOpportunities.map(opp => opp.lead_source).filter(Boolean))];

            populateSelect('regionFilter', regions);
            populateSelect('typeFilter', types);
            populateSelect('sourceFilter', sources);
        }

        // Populate select element
        function populateSelect(elementId, options) {
            const select = document.getElementById(elementId);
            const currentValue = select.value;
            
            // Clear existing options except first
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            options.sort().forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            });
            
            select.value = currentValue;
        }

        // Apply filters
        function applyFilters() {
            const regionFilter = document.getElementById('regionFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;
            const sourceFilter = document.getElementById('sourceFilter').value;

            filteredOpportunities = allOpportunities.filter(opp => {
                return (!regionFilter || opp.region === regionFilter) &&
                       (!typeFilter || opp.opportunity_type === typeFilter) &&
                       (!sourceFilter || opp.lead_source === sourceFilter);
            });

            updateDashboard();
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('regionFilter').value = '';
            document.getElementById('typeFilter').value = '';
            document.getElementById('sourceFilter').value = '';
            filteredOpportunities = [...allOpportunities];
            updateDashboard();
        }

        // Update dashboard with current data
        function updateDashboard() {
            processData();
            updateCharts();
            updateTable();
            updateInsights();
        }

        // Update all charts
        function updateCharts() {
            updateRevenueChart();
            updateRegionChart();
            updateDealSizeChart();
            updateLeadSourceChart();
        }

        // Update revenue by month chart
        function updateRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            
            // Group by month
            const monthlyRevenue = {};
            filteredOpportunities.forEach(opp => {
                if (opp.close_date) {
                    const month = new Date(opp.close_date).toISOString().substring(0, 7);
                    monthlyRevenue[month] = (monthlyRevenue[month] || 0) + (opp.amount || 0);
                }
            });

            const sortedMonths = Object.keys(monthlyRevenue).sort();
            const data = sortedMonths.map(month => monthlyRevenue[month]);

            if (charts.revenue) {
                charts.revenue.destroy();
            }

            charts.revenue = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedMonths.map(month => new Date(month + '-01').toLocaleDateString('en-US', { month: 'short', year: 'numeric' })),
                    datasets: [{
                        label: 'Revenue',
                        data: data,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update region chart
        function updateRegionChart() {
            const ctx = document.getElementById('regionChart').getContext('2d');
            
            const regionRevenue = {};
            filteredOpportunities.forEach(opp => {
                const region = opp.region || 'Unknown';
                regionRevenue[region] = (regionRevenue[region] || 0) + (opp.amount || 0);
            });

            const regions = Object.keys(regionRevenue);
            const data = regions.map(region => regionRevenue[region]);
            const colors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6'];

            if (charts.region) {
                charts.region.destroy();
            }

            charts.region = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: regions,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, regions.length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Update deal size distribution chart
        function updateDealSizeChart() {
            const ctx = document.getElementById('dealSizeChart').getContext('2d');
            
            const dealSizes = filteredOpportunities.map(opp => opp.amount || 0);
            const bins = [0, 25000, 50000, 100000, 250000, 500000, 1000000, Infinity];
            const binLabels = ['<$25K', '$25K-$50K', '$50K-$100K', '$100K-$250K', '$250K-$500K', '$500K-$1M', '>$1M'];
            const binCounts = new Array(bins.length - 1).fill(0);

            dealSizes.forEach(amount => {
                for (let i = 0; i < bins.length - 1; i++) {
                    if (amount >= bins[i] && amount < bins[i + 1]) {
                        binCounts[i]++;
                        break;
                    }
                }
            });

            if (charts.dealSize) {
                charts.dealSize.destroy();
            }

            charts.dealSize = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: binLabels,
                    datasets: [{
                        label: 'Number of Deals',
                        data: binCounts,
                        backgroundColor: 'rgba(46, 204, 113, 0.8)',
                        borderColor: '#2ecc71',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Update lead source performance chart
        function updateLeadSourceChart() {
            const ctx = document.getElementById('leadSourceChart').getContext('2d');
            
            const sourceRevenue = {};
            filteredOpportunities.forEach(opp => {
                const source = opp.lead_source || 'Unknown';
                sourceRevenue[source] = (sourceRevenue[source] || 0) + (opp.amount || 0);
            });

            const sources = Object.keys(sourceRevenue);
            const data = sources.map(source => sourceRevenue[source]);

            if (charts.leadSource) {
                charts.leadSource.destroy();
            }

            charts.leadSource = new Chart(ctx, {
                type: 'horizontalBar',
                data: {
                    labels: sources,
                    datasets: [{
                        label: 'Revenue',
                        data: data,
                        backgroundColor: 'rgba(243, 156, 18, 0.8)',
                        borderColor: '#f39c12',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        // Update opportunities table
        function updateTable() {
            const tbody = document.getElementById('opportunitiesTable');
            tbody.innerHTML = '';

            // Sort by amount descending
            const sortedOpportunities = [...filteredOpportunities].sort((a, b) => (b.amount || 0) - (a.amount || 0));

            sortedOpportunities.forEach(opp => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="fw-bold">${opp.opportunity_name || 'N/A'}</div>
                        <small class="text-muted">${opp.opportunity_id || ''}</small>
                    </td>
                    <td>${opp.account_name || 'N/A'}</td>
                    <td>${opp.owner_name || 'N/A'}</td>
                    <td class="fw-bold text-success">${formatCurrency(opp.amount || 0)}</td>
                    <td>${formatDate(opp.close_date)}</td>
                    <td><span class="region-badge ${getRegionClass(opp.region)}">${opp.region || 'N/A'}</span></td>
                    <td><span class="opportunity-type-badge ${getTypeClass(opp.opportunity_type)}">${opp.opportunity_type || 'N/A'}</span></td>
                    <td>${opp.lead_source || 'N/A'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update insights and recommendations
        function updateInsights() {
            generateInsights();
            generateRecommendations();
            generateRiskFactors();
        }

        // Generate key insights
        function generateInsights() {
            const insights = [];
            
            // Revenue concentration
            const regionRevenue = {};
            filteredOpportunities.forEach(opp => {
                const region = opp.region || 'Unknown';
                regionRevenue[region] = (regionRevenue[region] || 0) + (opp.amount || 0);
            });
            
            const totalRevenue = Object.values(regionRevenue).reduce((sum, rev) => sum + rev, 0);
            const topRegion = Object.keys(regionRevenue).reduce((a, b) => 
                regionRevenue[a] > regionRevenue[b] ? a : b, 'N/A');
            const topRegionPercentage = ((regionRevenue[topRegion] / totalRevenue) * 100).toFixed(1);
            
            insights.push(`${topRegion} drives ${topRegionPercentage}% of total revenue`);

            // Deal type analysis
            const typeRevenue = {};
            filteredOpportunities.forEach(opp => {
                const type = opp.opportunity_type || 'Unknown';
                typeRevenue[type] = (typeRevenue[type] || 0) + (opp.amount || 0);
            });
            
            const topType = Object.keys(typeRevenue).reduce((a, b) => 
                typeRevenue[a] > typeRevenue[b] ? a : b, 'N/A');
            
            insights.push(`${topType} opportunities generate highest revenue`);

            // Average deal size by region
            const regionCounts = {};
            filteredOpportunities.forEach(opp => {
                const region = opp.region || 'Unknown';
                regionCounts[region] = (regionCounts[region] || 0) + 1;
            });
            
            const avgDealSizes = {};
            Object.keys(regionRevenue).forEach(region => {
                avgDealSizes[region] = regionRevenue[region] / regionCounts[region];
            });
            
            const highestAvgRegion = Object.keys(avgDealSizes).reduce((a, b) => 
                avgDealSizes[a] > avgDealSizes[b] ? a : b, '');
            
            insights.push(`${highestAvgRegion} has highest average deal size: ${formatCurrency(avgDealSizes[highestAvgRegion])}`);

            document.getElementById('keyInsights').innerHTML = insights.map(insight => 
                `<div class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>${insight}</div>`
            ).join('');
        }

        // Generate recommendations
        function generateRecommendations() {
            const recommendations = [];
            
            // Lead source analysis
            const sourceRevenue = {};
            const sourceCounts = {};
            
            filteredOpportunities.forEach(opp => {
                const source = opp.lead_source || 'Unknown';
                sourceRevenue[source] = (sourceRevenue[source] || 0) + (opp.amount || 0);
                sourceCounts[source] = (sourceCounts[source] || 0) + 1;
            });
            
            const sourceEfficiency = {};
            Object.keys(sourceRevenue).forEach(source => {
                sourceEfficiency[source] = sourceRevenue[source] / sourceCounts[source];
            });
            
            const topSource = Object.keys(sourceEfficiency).reduce((a, b) => 
                sourceEfficiency[a] > sourceEfficiency[b] ? a : b, '');
            
            recommendations.push(`Focus on ${topSource} - highest revenue per deal`);
            
            // Renewal vs new business
            const renewalRevenue = filteredOpportunities
                .filter(opp => opp.opportunity_type === 'Renewal')
                .reduce((sum, opp) => sum + (opp.amount || 0), 0);
            
            const newBusinessRevenue = filteredOpportunities
                .filter(opp => opp.opportunity_type === 'New Business')
                .reduce((sum, opp) => sum + (opp.amount || 0), 0);
            
            if (renewalRevenue > newBusinessRevenue) {
                recommendations.push('Strengthen customer success to protect renewal revenue');
            } else {
                recommendations.push('Expand new business acquisition strategies');
            }
            
            // Regional expansion
            const regionCounts = {};
            filteredOpportunities.forEach(opp => {
                const region = opp.region || 'Unknown';
                regionCounts[region] = (regionCounts[region] || 0) + 1;
            });
            
            const lowestRegion = Object.keys(regionCounts).reduce((a, b) => 
                regionCounts[a] < regionCounts[b] ? a : b, '');
            
            recommendations.push(`Consider expansion efforts in ${lowestRegion} region`);

            document.getElementById('recommendations').innerHTML = recommendations.map(rec => 
                `<div class="mb-2"><i class="fas fa-arrow-right text-warning me-2"></i>${rec}</div>`
            ).join('');
        }

        // Generate risk factors
        function generateRiskFactors() {
            const risks = [];
            
            // Revenue concentration risk
            const ownerRevenue = {};
            filteredOpportunities.forEach(opp => {
                const owner = opp.owner_name || 'Unknown';
                ownerRevenue[owner] = (ownerRevenue[owner] || 0) + (opp.amount || 0);
            });
            
            const totalRevenue = Object.values(ownerRevenue).reduce((sum, rev) => sum + rev, 0);
            const topOwner = Object.keys(ownerRevenue).reduce((a, b) => 
                ownerRevenue[a] > ownerRevenue[b] ? a : b, '');
            const topOwnerPercentage = ((ownerRevenue[topOwner] / totalRevenue) * 100).toFixed(1);
            
            if (topOwnerPercentage > 30) {
                risks.push(`High dependency on ${topOwner} (${topOwnerPercentage}% of revenue)`);
            }
            
            // Account concentration
            const accountRevenue = {};
            filteredOpportunities.forEach(opp => {
                const account = opp.account_name || 'Unknown';
                accountRevenue[account] = (accountRevenue[account] || 0) + (opp.amount || 0);
            });
            
            const topAccount = Object.keys(accountRevenue).reduce((a, b) => 
                accountRevenue[a] > accountRevenue[b] ? a : b, '');
            const topAccountPercentage = ((accountRevenue[topAccount] / totalRevenue) * 100).toFixed(1);
            
            if (topAccountPercentage > 25) {
                risks.push(`High customer concentration: ${topAccount} (${topAccountPercentage}%)`);
            }
            
            // Lead source diversity
            const uniqueSources = new Set(filteredOpportunities.map(opp => opp.lead_source).filter(Boolean));
            if (uniqueSources.size < 3) {
                risks.push('Limited lead source diversity - consider expanding channels');
            }

            if (risks.length === 0) {
                risks.push('No significant risk factors identified');
            }

            document.getElementById('riskFactors').innerHTML = risks.map(risk => 
                `<div class="mb-2"><i class="fas fa-exclamation-triangle text-danger me-2"></i>${risk}</div>`
            ).join('');
        }

        // Export to CSV
        function exportToCSV() {
            const headers = [
                'Opportunity ID', 'Opportunity Name', 'Account Name', 'Owner Name',
                'Amount', 'Close Date', 'Region', 'Stage', 'Opportunity Type', 'Lead Source'
            ];
            
            const csvContent = [
                headers.join(','),
                ...filteredOpportunities.map(opp => [
                    opp.opportunity_id || '',
                    `"${opp.opportunity_name || ''}"`,
                    `"${opp.account_name || ''}"`,
                    `"${opp.owner_name || ''}"`,
                    opp.amount || 0,
                    opp.close_date || '',
                    opp.region || '',
                    opp.stage || '',
                    opp.opportunity_type || '',
                    opp.lead_source || ''
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `emea_opportunities_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            return new Date(dateString).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function getRegionClass(region) {
            if (!region) return '';
            if (region.includes('North')) return 'region-north';
            if (region.includes('South')) return 'region-south';
            if (region.includes('DACH')) return 'region-dach';
            return '';
        }

        function getTypeClass(type) {
            if (!type) return '';
            if (type.includes('Renewal')) return 'type-renewal';
            if (type.includes('Add-on')) return 'type-addon';
            if (type.includes('New')) return 'type-new';
            return '';
        }
    </script>
</body>
</html>
```

This comprehensive HTML dashboard provides:

## **Key Features:**

### **1. Executive Summary**
- Total revenue, deal count, average deal size
- Top performing region identification
- Real-time KPI calculations from full dataset

### **2. Interactive Data Loading**
- Fetches `opportunities.json` dynamically
- Loading states and error handling
- Automatic data processing and visualization updates

### **3. Advanced Analytics**
- Revenue trends by month with line charts
- Regional performance with doughnut charts
- Deal size distribution analysis
- Lead source effectiveness comparison

### **4. Solutions Engineer Insights**
- Automated insight generation based on data patterns
- Actionable recommendations for sales optimization
- Risk factor identification and mitigation strategies
- Customer concentration analysis

### **5. Interactive Features**
- Multi-dimensional filtering (region, type, lead source)
- Sortable and searchable data tables
- CSV export functionality
- Real-time chart updates based on filters

### **6. Professional Design**
- Bootstrap 5 responsive framework
- Executive-level presentation quality
- Mobile-optimized interface
- Consistent color coding and branding

### **7. Technical Implementation**
- Client-side data processing for scalability
- Chart.js for interactive visualizations
- Error handling and graceful degradation
- Modern JavaScript with async/await patterns

The dashboard automatically processes the complete dataset from `opportunities.json` and provides comprehensive business intelligence suitable for both executive decision-making and technical analysis.